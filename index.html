<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenova AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
    :root {
        /* Color Palette */
        --primary: #10a37f;
        --primary-light: rgba(16, 163, 127, 0.15);
        --primary-dark: #0e8e6f;
        --sidebar-bg: #1a1b1e;
        --chat-bg: #242529;
        --message-ai-bg: #2d2e33;
        --message-user-bg: #34363d;
        --text-primary: #f0f0f0;
        --text-secondary: #b0b3b8;
        --text-tertiary: #7d8085;
        --border-color: #3a3c42;
        --hover-bg: rgba(255, 255, 255, 0.05);
        --active-bg: rgba(255, 255, 255, 0.08);
        --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        --elevation-1: 0 1px 3px rgba(0, 0, 0, 0.12);
        --elevation-2: 0 4px 12px rgba(0, 0, 0, 0.15);
        
        /* Typography */
        --font-base: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        --font-mono: 'SF Mono', 'Roboto Mono', Menlo, monospace;
        --font-size-sm: 0.875rem;
        --font-size-md: 1rem;
        --font-size-lg: 1.125rem;
        --font-size-xl: 1.25rem;
        
        /* Spacing */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        
        /* Border Radius */
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 14px;
        --radius-xl: 18px;
        --radius-full: 9999px;
        
        /* Transitions */
        --transition-fast: 0.15s ease;
        --transition-normal: 0.3s ease;
        --transition-slow: 0.45s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* Base Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: var(--font-base);
        background-color: var(--chat-bg);
        color: var(--text-primary);
        height: 100vh;
        display: flex;
        overflow: hidden;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
    }

    /* Glassmorphism Sidebar */
    .sidebar {
        width: 280px;
        background-color: rgba(26, 27, 30, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        height: 100vh;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--border-color);
        transition: transform var(--transition-slow);
        z-index: 100;
        box-shadow: var(--elevation-2);
    }

    .sidebar-header {
        padding: var(--space-lg);
        border-bottom: 1px solid var(--border-color);
        position: relative;
    }

    /* Floating New Chat Button */
    .new-chat-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-sm);
        width: 100%;
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-md);
        background-color: var(--primary);
        color: white;
        border: none;
        cursor: pointer;
        transition: all var(--transition-fast);
        font-weight: 500;
        box-shadow: 0 2px 10px rgba(16, 163, 127, 0.3);
    }

    .new-chat-btn:hover {
        background-color: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(16, 163, 127, 0.4);
    }

    .new-chat-btn:active {
        transform: translateY(0);
    }

    /* Chat History List */
    .chat-history {
        flex: 1;
        overflow-y: auto;
        padding: var(--space-sm);
    }

    /* Chat Item Cards */
    .chat-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-md) var(--space-lg);
        margin-bottom: var(--space-xs);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-fast);
        position: relative;
        overflow: hidden;
    }

    .chat-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 3px;
        height: 100%;
        background-color: var(--primary);
        transform: translateX(-100%);
        transition: transform var(--transition-normal);
    }

    .chat-item:hover {
        background-color: var(--hover-bg);
    }

    .chat-item:hover::before {
        transform: translateX(0);
    }

    .chat-item.active {
        background-color: var(--active-bg);
    }

    .chat-item.active::before {
        transform: translateX(0);
    }

    .chat-item-title {
        font-size: var(--font-size-sm);
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
    }

    .chat-item-date {
        font-size: 0.75rem;
        color: var(--text-tertiary);
        margin-top: 2px;
    }

    /* Animated Action Buttons */
    .chat-item-actions {
        display: flex;
        gap: var(--space-xs);
        opacity: 0;
        transform: translateX(10px);
        transition: all var(--transition-normal);
    }

    .chat-item:hover .chat-item-actions {
        opacity: 1;
        transform: translateX(0);
    }

    .chat-item-btn {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        width: 28px;
        height: 28px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-fast);
    }

    .chat-item-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
    }

    /* Main Chat Area - Futuristic Design */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: 100vh;
        position: relative;
        overflow: hidden;
    }

    /* Gradient Overlay Effect */
    .main-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 20% 30%, rgba(16, 163, 127, 0.1) 0%, transparent 50%);
        pointer-events: none;
        z-index: -1;
    }

    /* Ultra-Smooth Chat Container */
    .chat-container {
        flex: 1;
        overflow-y: overlay; /* For fancy scrollbar */
        padding: var(--space-xl);
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }

    /* Message Bubbles with Depth */
    .message {
        display: flex;
        padding: var(--space-md) 0;
        position: relative;
        animation: fadeIn var(--transition-normal) forwards;
        opacity: 0;
    }

    @keyframes fadeIn {
        to { opacity: 1; }
    }

    .message-ai {
        background-color: var(--message-ai-bg);
        border-radius: 0 var(--radius-lg) var(--radius-lg) var(--radius-lg);
        margin-right: var(--space-xl);
        box-shadow: var(--elevation-1);
    }

    .message-user {
        background-color: var(--message-user-bg);
        border-radius: var(--radius-lg) 0 var(--radius-lg) var(--radius-lg);
        margin-left: var(--space-xl);
        align-self: flex-end;
        box-shadow: var(--elevation-1);
    }

    /* Avatar with Glow Effect */
    .avatar {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-md);
        margin: 0 var(--space-md);
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--primary);
        color: white;
        font-weight: bold;
        flex-shrink: 0;
        box-shadow: 0 0 0 2px var(--chat-bg), 0 0 15px rgba(16, 163, 127, 0.5);
    }

    .message-user .avatar {
        background-color: #5865f2;
        box-shadow: 0 0 0 2px var(--chat-bg), 0 0 15px rgba(88, 101, 242, 0.5);
    }

    /* Message Content with Perfect Typography */
    .message-content {
        flex: 1;
        padding-right: var(--space-xl);
        padding-left: var(--space-sm);
        min-width: 0; /* Fix flexbox overflow */
    }

    .message-text {
        line-height: 1.7;
        white-space: pre-wrap;
        font-size: var(--font-size-md);
        hyphens: auto;
    }

    /* Premium Code Blocks */
    .message-text pre {
        background: #1e1f25;
        color: #e3e3e3;
        padding: var(--space-md);
        border-radius: var(--radius-md);
        overflow-x: auto;
        margin: var(--space-md) 0;
        font-family: var(--font-mono);
        font-size: 0.9rem;
        border-left: 3px solid var(--primary);
        box-shadow: inset 0 1px 10px rgba(0, 0, 0, 0.3);
    }

    .message-text code {
        background: rgba(30, 31, 37, 0.7);
        color: #e3e3e3;
        padding: 0.2em 0.4em;
        border-radius: var(--radius-sm);
        font-family: var(--font-mono);
        font-size: 0.9em;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .message-text blockquote {
        border-left: 3px solid var(--primary);
        margin: var(--space-md) 0;
        padding-left: var(--space-md);
        color: var(--text-secondary);
        font-style: italic;
    }

    /* Floating Action Buttons */
    .copy-btn {
        position: absolute;
        top: var(--space-md);
        right: var(--space-md);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        border: none;
        color: var(--text-secondary);
        border-radius: var(--radius-sm);
        padding: var(--space-xs) var(--space-sm);
        cursor: pointer;
        opacity: 0;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        gap: var(--space-xs);
        font-size: var(--font-size-sm);
    }

    .message:hover .copy-btn {
        opacity: 1;
    }

    .copy-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: var(--text-primary);
    }

    /* Input Area - Futuristic Design */
    .input-container {
        padding: var(--space-lg);
        position: relative;
        background: rgba(36, 37, 41, 0.8);
        backdrop-filter: blur(10px);
        border-top: 1px solid var(--border-color);
        box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
    }

    .input-box {
        display: flex;
        align-items: center;
        background-color: rgba(45, 46, 51, 0.5);
        border-radius: var(--radius-lg);
        padding: var(--space-sm);
        transition: all var(--transition-normal);
        border: 1px solid transparent;
    }

    .input-box:focus-within {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(16, 163, 127, 0.2);
    }

    /* Modern Text Input */
    #userInput {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--text-primary);
        padding: var(--space-sm);
        font-size: var(--font-size-md);
        outline: none;
        resize: none;
        max-height: 150px;
        line-height: 1.6;
    }

    #userInput::placeholder {
        color: var(--text-tertiary);
    }

    /* Sleek File Button */
    .file-btn {
        background: none;
        border: none;
        color: var(--text-secondary);
        padding: var(--space-sm);
        cursor: pointer;
        border-radius: var(--radius-sm);
        transition: all var(--transition-fast);
    }

    .file-btn:hover {
        color: var(--text-primary);
        background: rgba(255, 255, 255, 0.1);
    }

    /* Send Button with Micro-Interaction */
    #sendButton {
        background: var(--primary);
        color: white;
        border: none;
        border-radius: var(--radius-md);
        padding: var(--space-sm) var(--space-md);
        cursor: pointer;
        transition: all var(--transition-fast);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #sendButton:not(:disabled):hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
    }

    #sendButton:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }

    /* End Chat Button */
    .end-chat-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-sm);
        width: 100%;
        background: transparent;
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: var(--space-sm);
        margin-top: var(--space-md);
        cursor: pointer;
        transition: all var(--transition-fast);
    }

    .end-chat-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
    }

    /* Typing Indicator Animation */
    .typing-indicator {
        display: flex;
        padding: var(--space-md) 0;
        align-items: center;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        background-color: var(--text-secondary);
        border-radius: 50%;
        margin: 0 3px;
        animation: typingAnimation 1.4s infinite ease-in-out;
    }

    @keyframes typingAnimation {
        0%, 60%, 100% { 
            transform: translateY(0); 
            opacity: 0.6;
        }
        30% { 
            transform: translateY(-5px); 
            opacity: 1;
        }
    }

    /* File Preview Styles */
    .file-preview {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-sm);
        margin-top: var(--space-md);
    }

    .file-item {
        position: relative;
        border-radius: var(--radius-sm);
        overflow: hidden;
    }

    .file-item img {
        max-width: 100%;
        max-height: 200px;
        border-radius: var(--radius-sm);
        display: block;
    }

    .file-remove {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(0, 0, 0, 0.7);
        border: none;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: var(--radius-full);
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--text-tertiary);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .sidebar {
            position: absolute;
            width: 85%;
            max-width: 300px;
            transform: translateX(-100%);
            box-shadow: var(--card-shadow);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .chat-container {
            padding: var(--space-md);
        }

        .message {
            padding: var(--space-sm) 0;
        }

        .message-ai {
            margin-right: var(--space-md);
        }

        .message-user {
            margin-left: var(--space-md);
        }
    }

    /* Special Effects */
    .message-text a {
        color: var(--primary);
        text-decoration: none;
        position: relative;
    }

    .message-text a::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 1px;
        background-color: var(--primary);
        transition: width var(--transition-fast);
    }

    .message-text a:hover::after {
        width: 100%;
    }

    /* Notification Toast */
    .toast {
        position: fixed;
        bottom: var(--space-lg);
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary);
        color: white;
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-md);
        box-shadow: var(--elevation-2);
        z-index: 1000;
        animation: slideUp 0.3s ease, fadeOut 0.3s ease 2s forwards;
    }

    @keyframes slideUp {
        from { transform: translate(-50%, 20px); opacity: 0; }
        to { transform: translate(-50%, 0); opacity: 1; }
    }

    @keyframes fadeOut {
        to { opacity: 0; }
    }
</style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i>
                New chat
            </button>
        </div>
        <div class="chat-history" id="chatHistory">
            <!-- Chat items will be added here dynamically -->
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="chat-container" id="chatContainer">
            <!-- Messages will be added here dynamically -->
        </div>

        <div class="input-container">
            <div class="input-box">
                <button type="" class="file-btn" id="fileBtn" title="Attach file">
                    <i class="fas fa-paperclip"><input type="image" src="" alt=""></i>
                    
                </button>
                <textarea id="userInput" placeholder="Message Zenova..." rows="1"></textarea>
                <button id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <button class="end-chat-btn" id="endChatBtn">End Chat</button>
        </div>
    </div>

    <script>
        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const chatHistory = document.getElementById('chatHistory');
        const chatContainer = document.getElementById('chatContainer');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const newChatBtn = document.getElementById('newChatBtn');
        const fileBtn = document.getElementById('fileBtn');
        const fileInput = document.getElementById('fileInput');
        const endChatBtn = document.getElementById('endChatBtn');

        // State
        let currentChatId = null;
        let chats = JSON.parse(localStorage.getItem('zenova-chats')) || [];
        let isStreaming = false;

        // Initialize the app
        function init() {
            renderChatList();
            if (chats.length > 0) {
                loadChat(chats[0].id);
            } else {
                createNewChat();
            }

            // Event listeners
            sendButton.addEventListener('click', sendMessage);
            userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            newChatBtn.addEventListener('click', createNewChat);
            fileBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            endChatBtn.addEventListener('click', endCurrentChat);
        }

        // Create a new chat
        function createNewChat() {
            const newChat = {
                id: Date.now().toString(),
                title: "New Chat",
                messages: [],
                createdAt: new Date().toISOString(),
                active: true
            };

            // Deactivate all other chats
            chats.forEach(chat => chat.active = false);
            
            chats.unshift(newChat);
            saveChats();
            renderChatList();
            loadChat(newChat.id);
            userInput.focus();
        }

        // Load a chat
        function loadChat(chatId) {
            currentChatId = chatId;
            const chat = chats.find(c => c.id === chatId);
            
            if (!chat) return;
            
            // Update active state
            chats.forEach(c => c.active = c.id === chatId);
            renderChatList();
            
            // Clear and reload messages
            chatContainer.innerHTML = '';
            chat.messages.forEach(msg => {
                addMessageToUI(msg.role, msg.content, msg.files);
            });
            
            scrollToBottom();
        }

        // Save chats to localStorage
        function saveChats() {
            localStorage.setItem('zenova-chats', JSON.stringify(chats));
        }

        // Render the chat list in sidebar
        function renderChatList() {
            chatHistory.innerHTML = '';
            
            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${chat.active ? 'active' : ''}`;
                chatItem.innerHTML = `
                    <span>${chat.title}</span>
                    <div class="chat-item-actions">
                        <button class="chat-item-btn delete-chat" data-id="${chat.id}" title="Delete chat">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                chatItem.addEventListener('click', () => loadChat(chat.id));
                chatHistory.appendChild(chatItem);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-chat').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteChat(e.target.closest('.delete-chat').dataset.id);
                });
            });
        }

        // Delete a chat
        function deleteChat(chatId) {
            if (confirm('Are you sure you want to delete this chat?')) {
                chats = chats.filter(chat => chat.id !== chatId);
                
                if (currentChatId === chatId) {
                    if (chats.length > 0) {
                        loadChat(chats[0].id);
                    } else {
                        createNewChat();
                    }
                }
                
                saveChats();
                renderChatList();
            }
        }

        // End current chat
        function endCurrentChat() {
            if (currentChatId) {
                const chat = chats.find(c => c.id === currentChatId);
                if (chat) {
                    chat.messages = [];
                    saveChats();
                    loadChat(currentChatId);
                }
            }
        }

        // Add message to UI
        function addMessageToUI(role, content, files = [], isStreaming = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${role}`;
            
          const avatar = document.createElement('div');
avatar.className = 'avatar';

if (role === 'user') {
  avatar.textContent = 'Y'; // Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ ÙˆØ¶Ø¹ ØµÙˆØ±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙŠØ¶Ù‹Ø§
} else {
  const gif = document.createElement('img');
  gif.src = 'gif.gif'; // ðŸ” Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù€ GIF
  gif.alt = 'Avatar';
  gif.style.width = '36px';
    gif.style.height = '36px';
  gif.className = 'avatar-gif'; // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… CSS Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙˆØ±Ø©
  avatar.appendChild(gif);
}

            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            
            if (isStreaming) {
                // For streaming messages, update existing content
                const lastMessage = chatContainer.lastChild;
                if (lastMessage && lastMessage.classList.contains('message-ai')) {
                    lastMessage.querySelector('.message-text').innerHTML = marked.parse(content);
                    addCopyButtons();
                    scrollToBottom();
                    return;
                }
            }
            
            if (role === 'ai') {
                textDiv.innerHTML = marked.parse(content);
            } else {
                textDiv.textContent = content;
            }
            
            // Add files if any
            if (files.length > 0) {
                files.forEach(file => {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'message-file';
                    fileDiv.style.marginTop = '10px';
                    
                    if (file.type.startsWith('image/')) {
                        const img = document.createElement('img');
                        img.src = file.url;
                        img.style.maxWidth = '100%';
                        img.style.maxHeight = '300px';
                        img.style.borderRadius = '5px';
                        fileDiv.appendChild(img);
                    } else {
                        const fileLink = document.createElement('a');
                        fileLink.href = file.url;
                        fileLink.textContent = file.name;
                        fileLink.target = '_blank';
                        fileLink.style.color = 'inherit';
                        fileDiv.appendChild(fileLink);
                    }
                    
                    textDiv.appendChild(fileDiv);
                });
            }
            
            contentDiv.appendChild(textDiv);
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            
            // Add copy button for AI messages
            if (role === 'ai') {
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                copyBtn.title = 'Copy to clipboard';
                copyBtn.addEventListener('click', () => copyToClipboard(content));
                messageDiv.appendChild(copyBtn);
            }
            
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
            addCopyButtons();
        }

        // Add copy buttons to code blocks
        function addCopyButtons() {
            document.querySelectorAll('.message-text pre').forEach(pre => {
                if (!pre.querySelector('.copy-btn')) {
                    const code = pre.querySelector('code') || pre;
                    const copyBtn = document.createElement('button');
                    copyBtn.className = 'copy-btn';
                    copyBtn.innerHTML = '<i class="far fa-copy"></i>';
                    copyBtn.title = 'Copy code';
                    copyBtn.addEventListener('click', () => copyToClipboard(code.textContent));
                    pre.style.position = 'relative';
                    pre.appendChild(copyBtn);
                }
            });
        }

        // Copy text to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary feedback
                const notification = document.createElement('div');
                notification.textContent = 'Copied!';
                notification.style.position = 'fixed';
                notification.style.bottom = '20px';
                notification.style.right = '20px';
                notification.style.backgroundColor = 'var(--primary)';
                notification.style.color = 'white';
                notification.style.padding = '10px 20px';
                notification.style.borderRadius = '5px';
                notification.style.zIndex = '1000';
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 2000);
            });
        }

        // Handle file upload
        function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;
            
            // For demo purposes, we'll create object URLs
            // In a real app, you would upload these to a server
            const uploadedFiles = files.map(file => ({
                name: file.name,
                type: file.type,
                size: file.size,
                url: URL.createObjectURL(file)
            }));
            
            // Add message with files
            const message = {
                role: 'user',
                content: `I've uploaded ${files.length} file(s)`,
                files: uploadedFiles
            };
            
            addMessageToUI(message.role, message.content, message.files);
            saveMessageToChat(message);
            
            // Clear file input
            fileInput.value = '';
        }

        // Save message to current chat
        function saveMessageToChat(message) {
            const chat = chats.find(c => c.id === currentChatId);
            if (chat) {
                chat.messages.push(message);
                
                // Update chat title if it's the first message
                if (chat.messages.length === 1 && message.role === 'user') {
                    chat.title = message.content.substring(0, 30) + (message.content.length > 30 ? '...' : '');
                }
                
                saveChats();
                renderChatList();
            }
        }

        // Send message to AI
        async function sendMessage() {
            const content = userInput.value.trim();
            if (!content || isStreaming) return;
            
            // Add user message
            const userMessage = {
                role: 'user',
                content: content,
                files: []
            };
            
            addMessageToUI(userMessage.role, userMessage.content);
            saveMessageToChat(userMessage);
            
            // Clear input
            userInput.value = '';
            adjustTextareaHeight();
            
            // Add loading indicator
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message message-ai';
            loadingDiv.innerHTML = `
                <div class="avatar">Z</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(loadingDiv);
            scrollToBottom();
            
            isStreaming = true;
            
            try {
                // Get conversation history
                const messages = getConversationHistory();
                
                // Call AI API
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": "Bearer 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",
                        "HTTP-Referer": window.location.href,
                        "X-Title": "Zenova AI",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: "deepseek/deepseek-r1:free",
                        messages: messages,
                        stream: true
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                // Process streaming response
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let aiResponse = '';
                
                // Remove loading indicator
                chatContainer.removeChild(loadingDiv);
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data:') && !line.includes('[DONE]')) {
                            try {
                                const data = JSON.parse(line.substring(5));
                                const token = data.choices[0]?.delta?.content || '';
                                aiResponse += token;
                                
                                // Update message with new content
                                addMessageToUI('ai', aiResponse, [], true);
                            } catch (e) {
                                console.error('Error parsing stream data:', e);
                            }
                        }
                    }
                }
                
                // Save final AI message
                const aiMessage = {
                    role: 'ai',
                    content: aiResponse
                };
                
                saveMessageToChat(aiMessage);
                
            } catch (error) {
                console.error('Error:', error);
                addMessageToUI('ai', `Sorry, an error occurred: ${error.message}`);
            } finally {
                isStreaming = false;
            }
        }

        // Get conversation history for API
        function getConversationHistory() {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return [];
            
            return chat.messages.map(msg => ({
                role: msg.role === 'ai' ? 'assistant' : msg.role,
                content: msg.content
            }));
        }

        // Adjust textarea height based on content
        function adjustTextareaHeight() {
            userInput.style.height = 'auto';
            userInput.style.height = (userInput.scrollHeight) + 'px';
        }

        // Scroll to bottom of chat
        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Auto-resize textarea
            userInput.addEventListener('input', adjustTextareaHeight);
            
            // Initialize app
            init();
        });
        
    </script>
</body>
</html>